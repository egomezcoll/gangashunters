/*
    angularGrid.js v 0.3.3
    Author: Sudhanshu Yadav
    Copyright (c) 2015 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo on: http://ignitersworld.com/lab/angulargrid/demo1.html
    Documentation and download on https://github.com/s-yadav/angulargrid 
*/

!function(n,t){"use strict";function i(n){return n.complete&&("undefined"==typeof n.naturalWidth||0!==n.naturalWidth)}function a(n){return Array.prototype.slice.call(n)}var e={gridWidth:300,gutterSize:10,refreshOnImgLoad:!0},o=function(){var i=n.element(t);return function(n){return i[0]=n,i}}();n.element(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important;}</style>"),n.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(t,r,d,s){return{restrict:"A",link:function(u,l,f){function c(){var n=w.offsetWidth,t=Math.floor(n/(y.gridWidth+y.gutterSize)),i=n%(y.gridWidth+y.gutterSize)+y.gutterSize,a=y.gridWidth+Math.floor(i/t);return{no:t,width:a}}function g(t,e){var o=e.beforeLoad||n.noop,r=e.onLoad||n.noop,s=e.isLoaded||n.noop,u=e.onFullLoad||n.noop,l=e.ignoreCheck||n.noop,f=t.find("img"),c=[];a(f).forEach(function(n){o(n),i(n)||l(n)?s(n):c.push(d(function(t,i){n.onload=function(){r(n),t()},n.onerror=i}))}),c.length?d.all(c).then(u,u):setTimeout(function(){u()},0)}function h(){for(var t,i=c(),e=i.width,r=i.no,d=[],t=0;r>t;t++)d.push(0);a(v).forEach(function(t){var i=o(t);a(i.find("img")).forEach(function(t){var a=n.element(t);if(a.hasClass("img-loaded"))return void a.css("height","");i.addClass("ag-no-transition"),i.css("width",e+"px");var o=a.attr("actual-width")||a.attr("data-actual-width"),r=a.attr("actual-height")||a.attr("data-actual-height");o&&r&&a.css("height",r*t.width/o+"px")}),i.removeClass("ag-no-transition")});var s=v.clone();s.addClass("ag-no-transition"),s.css({visibility:"hidden",opacity:0,width:e+"px",top:0,left:0}),l.append(s),g(s,{ignoreCheck:function(n){return!o(n).hasClass("img-loaded")},onFullLoad:function(){var n,t,i,a=[];for(t=0,i=s.length;i>t;t++)a.push(s[t].offsetHeight);for(t=0,i=v.length;i>t;t++){n=o(v[t]);var r=a[t],u=Math.min.apply(Math,d),f=d.indexOf(u);d[f]=u+r+y.gutterSize;var c=f*(e+y.gutterSize);n.css({top:u+"px",left:c+"px",width:e+"px"})}l.css("height",Math.max.apply(Math,d)+"px"),s.remove()}})}function m(){var i=!1;a(v).forEach(function(a){var e=n.element(a),r=e.find("img");r.length&&(e.addClass("img-loading"),g(e,{beforeLoad:function(n){o(n).addClass("img-loading")},isLoaded:function(n){o(n).removeClass("img-loading").addClass("img-loaded")},onLoad:function(n){!i&&y.refreshOnImgLoad&&(i=!0,t(function(){h(),i=!1},100)),o(n).removeClass("img-loading").addClass("img-loaded")},onFullLoad:function(){e.removeClass("img-loading").addClass("img-loaded")}}))})}function p(){var n=a(v).filter(function(n){return o(n).hasClass("ng-leave")});return d(function(i){n.length?o(n[0]).one("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){t(function(){v=l.children(),i()})}):i()})}var v,C,w=l[0],L=n.element(r),W=f.angularGridId,z=f.angularGrid,y={gridWidth:f.gridWidth?parseInt(f.gridWidth):e.gridWidth,gutterSize:f.gutterSize?parseInt(f.gutterSize):e.gutterSize,refreshOnImgLoad:"false"==f.refreshOnImgLoad?!1:!0};u.$watch(z,function(){t(function(){v=l.children(),p().then(function(){m(),t(function(){l.addClass("angular-grid"),h()})})})},!0);var S=w.offsetWidth;L.on("resize",function(){var n=w.offsetWidth;S!=n&&(S=n,C&&t.cancel(C),C=t(function(){h()},100))}),W&&(s[W]={refresh:h})}}}]).factory("angularGridInstance",function(){var n={};return n})}(angular,window);